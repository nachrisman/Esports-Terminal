<% include ./partials/header %>

  <div class='container-fluid' id='primary-wrapper'>
  	<div class='row'>
  		<div class='col-xs-3 col-md-3'>
  			<div class='account-nav'>
  				<h3>My Account</h3>
  				<ul>
  					<li><a href='/account/meta-settings'>META Settings</a></li>
  					<li><a href='/account/info'>Account Information</a></li>
  					<li><a href='/account/security'>Security</a></li>
  					<li><a href='/logout'>Log Out</a></li>
  				</ul>
  			</div>
  		</div>
  		<div class='col-xs-9 col-md-9'>
  			<div class='account-content'>
  				<div class='meta-settings'>
            <h1>Games</h1>
            <p>These are your game subscriptions. Change them anytime!</p>
            <form class='user-meta-settings' action='/account/meta-settings?_method=PUT' method='POST'>
              <div class='row'>
                <div class='col-xs-6 col-md-6' id='meta-titles'>
                  <h3>Titles</h3>
                  <% var userMeta = currentUser.meta; %>
                  <% games.forEach(function(game) {   %>
                  <%   if(userMeta.find(meta => meta.game == game.title)) { %>
                      <label>
                        <input type='checkbox' name='title' value='<%= game.title %>' checked> <% if(game.abbreviation != 'None'){ %> <%= game.abbreviation %> <% } else { %> <%=game.title %> <% } %>
                      </label>
                  <% } else { %>
                      <label>
                        <input type='checkbox' name='title' value='<%= game.title %>'> <% if(game.abbreviation != 'None'){ %> <%= game.abbreviation %> <% } else { %> <%=game.title %> <% } %>
                      </label>
                  <% } %>
                  <% }); %>
                </div>
                <div class='col-xs-3 col-md-3' id='meta-events-sub'>
                  <h3>Events</h3>
                  <% var subscribedEvents = []; %>
                  <% var nonSubscribedEvents = []; %>
                  <% userMeta.forEach(function(meta){ %>
                  <%    if(meta.events == true){ %>
                  <%      subscribedEvents.push(meta); %>
                  <% } else { %>
                  <%   nonSubscribedEvents.push(meta); %>
                  <% } %>
                  <% }); %>
                  <% games.forEach(function(game) {   %>
                  <%   if(subscribedEvents.find(meta => (meta.game == game.title))) { %>
                            <select id='events-check' type='select' name='events'>
                              <option value='subscribed' selected>Subscribed</option>
                              <option value='unsubscribed'>Not Subscribed</option>
                              <option>Select an Option</option>
                            </select>
                  <% } else if(nonSubscribedEvents.find(meta => (meta.game == game.title))) { %>
                            <select id='events-check' type='select' name='events'>
                              <option value='subscribed'>Subscribed</option>
                              <option value='unsubscribed' selected>Not Subscribed</option>
                              <option>Select an Option</option>
                            </select>
                  <% } else { %>
                            <select id='events-check' type='select' name='events' disabled>
                              <option selected>Select an Option</option>
                              <option value='subscribed' >Subscribed</option>
                              <option value='unsubscribed'>Not Subscribed</option>
                            </select>
                           <% } %>
                  <% }); %>
                </div>
                <div class='col-xs-3 col-md-3' id='meta-news-sub'>
                  <h3>News</h3>
                  <% var subscribedNews = []; %>
                  <% var nonSubscribedNews = []; %>
                  <% userMeta.forEach(function(meta){ %>
                  <%    if(meta.news == true){ %>
                  <%      subscribedNews.push(meta); %>
                  <% } else { %>
                  <%   nonSubscribedNews.push(meta); %>
                  <% } %>
                  <% }); %>
                  <% games.forEach(function(game){ %>
                    <% if(subscribedNews.find(meta => (meta.game == game.title))) { %>
                      <select id='news-check' type='select' name='news'>
                        <option value='subscribed' selected>Subscribed</option>
                        <option value='unsubscribed'>Not Subscribed</option>
                        <option>Select an Option</option>
                      </select>
                  <% } else if(nonSubscribedNews.find(meta => (meta.game == game.title))){ %>
                      <select id='news-check' type='select' name='news'>
                        <option value='subscribed'>Subscribed</option>
                        <option value='unsubscribed' selected>Not Subscribed</option>
                        <option>Select an Option</option>
                      </select>
                    <% } else { %>
                      <select id='news-check' type='select' name='news' disabled>
                        <option value='subscribed'>Subscribed</option>
                        <option value='unsubscribed' >Not Subscribed</option>
                        <option selected>Select an Option</option>
                      </select>
                  <% } %>
                  <% }); %>
                </div>
              </div>
              <button class='btn btn-success' type='submit'>Save Changes</button>
            </form>
          </div>
  			</div>
  		</div>
  	</div>
  </div>
<% include ./partials/footer %>